<% layout('layout') -%>
<section class="account">
  <h1>Your Account</h1>
  <p>View purchases, favorites, and support.</p>
  <section class="chat">
    <h2>Chat Support</h2>
    <form class="chat-form" method="post" action="/chat" onsubmit="return sendChat(event)">
      <input type="text" name="message" id="chat-input" placeholder="Type a message" />
      <button type="submit" class="button">Send</button>
    </form>
    <div id="chat-reply" class="chat-reply"></div>
  </section>
</section>
<script>
  async function sendChat(e){
    e.preventDefault();
    const input = document.getElementById('chat-input');
    const res = await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:input.value})});
    const data = await res.json();
    document.getElementById('chat-reply').textContent = data.reply;
    input.value = '';
    return false;
  }
</script>
